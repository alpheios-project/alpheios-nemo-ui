<!DOCTYPE html>
<html lang="{{ lang }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above three meta tags *must* come first in the head; any other head content must come *after* these tags -->
    
    <!-- PWA tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0E2233"/>

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link href="images/splashscreens/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="images/splashscreens/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <!-- End of PWA tags -->

    <title>Alpheios Texts</title>
    {% for filename, directory in assets["css"].items() %}
      {% if directory %}<link rel="stylesheet" href="{{url_for('.secondary_assets', filetype='css', asset=filename)}}">
      {% else %}<link rel="stylesheet" href="{{ filename }}">
      {% endif %}
    {% endfor %}
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>

    <meta name="alpheios-pedagogical-text" content="true"/>
    {% if 'greekLit' in objectId %}
    <meta name="alpheios-treebank-url" content="http://tools.alpheios.net/exist/rest/db/xq/treebank-getmorph.xq?f={{ objectId | replace('urn:cts:greekLit:','')}}&amp;w=WORD">
    <meta name="alpheios-treebank-diagram-url" content="version=1.0;http://tools.alpheios.net/exist/rest/db/app/treebank-editsentence.xhtml?doc={{objectId | replace('urn:cts:greekLit:','')}}&amp;app=viewer&amp;id=SENTENCE&amp;w=WORD">
    <meta name="alpheios-v2-treebank-diagram-url" data-alpheios_tb_src="https://alpheios.net/alpheios-treebanks/{{objectId | replace('urn:cts:greekLit:','')}}.html?chunk=SENTENCE&amp;w=WORD">
    {% elif 'latinLit' in objectId %}
    <meta name="alpheios-treebank-url" content="http://tools.alpheios.net/exist/rest/db/xq/treebank-getmorph.xq?f={{ objectId | replace('urn:cts:latinLit:','')}}&amp;w=WORD">
    <meta name="alpheios-treebank-diagram-url" content="version=1.0;http://tools.alpheios.net/exist/rest/db/app/treebank-editsentence.xhtml?doc={{objectId | replace('urn:cts:latinLit:','')}}&amp;app=viewer&amp;id=SENTENCE&amp;w=WORD">
    <meta name="alpheios-v2-treebank-diagram-url" data-alpheios_tb_src="https://alpheios.net/alpheios-treebanks/DOC.html?chunk=SENTENCE&amp;w=WORD">
    {% endif %}
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
      console.log(`Head script execution has been started`)
      if ('serviceWorker' in navigator) { // Checks if Service Workers are supported by the browser

        /*
        Register service worker only after a page is fully loaded so that the service worker registration
        would not slow down page showing.
         */
        window.addEventListener('load', () => {
          // Delay registration until document is parsed and fully loaded

          console.log("Navigator online state is " + navigator.onLine)
          if (navigator.onLine === true) {
            console.log(`Registering a service worker ...`)
            navigator.serviceWorker.register('/sw.js', {scope: '/'})
              .then(reg => console.log('Service worker has been registered!', reg))
              .catch(err => console.log('Service worker failed to register', err));
          } else {
            console.log(`Skipping a service worker registration because we're offline`)
          }
        })

        window.addEventListener('beforeinstallprompt', (e) => {
          // Prevent Chrome 67 and earlier from automatically showing the prompt
          e.preventDefault()
          e.prompt()
          // Wait for the user to respond to the prompt
          e.userChoice
            .then((choiceResult) => {
              if (choiceResult.outcome === 'accepted') {
                console.log('User accepted the Alpheios Reader Tools prompt');
              } else {
                console.log('User dismissed the Alpheios Reader Tools prompt');
              }
            })
        })
      } else {
        console.log('Service workers are not supported.');
      }
      document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM content loaded callback')
      })
      document.addEventListener('load', () => {
        console.log('Document loaded callback')
      })
      window.addEventListener('load', () => {
        console.log('Window loaded callback')
      })
    </script>
  </head>
  <body>
    {% block article %}
    {% endblock %}


    {% for filename, directory in assets["js"].items() %}
      {% if directory %}<script src="{{url_for('.secondary_assets', filetype='js', asset=filename)}}"></script>
      {% else %}<script src="{{ filename }}"></script>
      {% endif %}
    {% endfor %}


  {% block additionalscript %}
  {% endblock %}
  {% block pagePopups %}
    {% include "alpheios::helppopup.html" %}
  {% endblock %}
  {% block footer %}
    {% include "main::footer.html" %}
  {% endblock %}
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function(event) {
      const embedded = new Alpheios.Embedded({
        'clientId':'alpheios-reader',
        'enabledSelector':'.entry-content',
        popupInitialPos: {
          left: '50px',
          top: '230px'
        },
        toolbarInitialPos: {
          top: '220px',
          right: '15px'
        },
        layoutType: 'readingTools'
      })
      embedded.activate()
        .then(function () {
          if (embedded.platform.isMobile) {
            let toolsEl = document.querySelector('#alph-tools-ctrl')
            if (toolsEl) {
              toolsEl.addEventListener('click', function () {
                embedded.openActionPanel({
                  toolbarModule: 'actionPanel'
                })
              }, { passive: true })
            }
          }
        })
        .catch(function(e) {
          console.error(`Alpheios cannot be activated`, e)
        });
    });

  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', '{{gtrack}}', 'auto');
    ga('send', 'pageview');

  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
  <script>
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
    })});
  </script>
  </body>
</html>
